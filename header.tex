%!TEX root = desc.tex
\newif\ifdraft\drafttrue

\documentclass[11pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage[sort&compress,numbers]{natbib}
% amsthm needs to go before newtx for compatability reasons
\usepackage{amsthm,amssymb}
\usepackage{newtx}
\usepackage{microtype}
\frenchspacing

\usepackage{mathpartir}
\usepackage{stmaryrd}
\usepackage{mathtools}

\usepackage{suffix}
\usepackage{xparse}

%\usepackage{pslatex}
%\usepackage{fullpage}
\usepackage{xspace}
\usepackage{verbatim}
\usepackage{enumitem}
%\usepackage{wrapfig}
%\usepackage{tgpagella}
\usepackage{url}
\usepackage{breakurl}
\usepackage[hidelinks,bookmarks=true]{hyperref}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{titlesec}
%\usepackage{fancyhdr}
\usepackage{float}
\usepackage[font=small]{caption}
\usepackage[table,dvipsnames]{xcolor}

\setlist[itemize,enumerate]{
  itemsep=0pt,
  topsep=1ex,
}

% ===== Title and section header formatting ====
\makeatletter
\def\@author{}
\def\author#1#2{\expandafter\def\expandafter\@author\expandafter{\@author{#1}{#2}}}
\def\typeset@authors#1#2#3\_nil{%
  \begin{tabular}[t]{c}#1\end{tabular}\\
  {\large #2}
  \ifx\relax#3\relax\else\and\typeset@authors#3\_nil\fi%
}
\def\maketitle{
  \newpage%
  \vbox to 1.2in{
    \centering
    \vspace*{\fill}
      {\LARGE\bfseries\@title\par}
      \vskip 0.75em
      {\Large\begin{tabular}[t]{c}\expandafter\typeset@authors\@author\_nil\end{tabular}\par}
    \vspace*{\fill}
  }
%  \begin{titlepage}
%    \centering
%    \vspace*{\fill}
%      {\huge\@title\par}
%      \vskip 2em
%      {\Large\begin{tabular}[t]{c}\expandafter\typeset@authors\@author\_nil\end{tabular}\par}
%    \vspace*{\fill}
%  \end{titlepage}
}
%\def\typeset@affils#1#2#3\_nil{\textsuperscript{#1}#2\ifx\relax#3\relax\else\and\typeset@affils#3\_nil\fi}
%\newcommand{\affils}[1]{\def\@affils{#1}}
%\def\maketitle{
%  \newpage%
%  \vbox to 0.9in{
%    \centering
%    \vspace*{\fill}
%      {\Large\bfseries\@title\par}
%      \vskip 1ex
%      {\normalsize\begin{tabular}[t]{c}\@author\end{tabular}\par}
%      \ifx\relax\@affils\relax\else
%        \vskip 0.5ex
%        {\small\begin{tabular}[t]{c}\expandafter\typeset@affils\@affils\_nil\end{tabular}\par}
%      \fi
%    \vspace*{\fill}
%  }
%}
\makeatother

\titlespacing*{\section}{0pt}{*2.5}{*2}
\titlespacing*{\subsection}{0pt}{*2}{*1}
%\titlespacing*{\subsubsection}{0pt}{*0.75}{*0.5}
\titleformat{\paragraph}[runin]{\bfseries}{}{0pt}{}[.]
\titlespacing{\paragraph}{0pt}{*1.5}{*1}
\titleformat{\subparagraph}[runin]{\bfseries}{}{0pt}{}
\titlespacing{\subparagraph}{0pt}{*1}{*1}

\makeatletter
\newcounter{ex@cntr}
\newenvironment{example}[1]{%
  \par\vspace{1.5ex plus 0.5ex minus 0.5ex}%
  \noindent%
  \addtocounter{ex@cntr}{1}%
  \textbf{Example \theex@cntr: #1.}\hspace{1ex plus 0.5ex minus 0.5ex}\ignorespaces%
}{\par\medskip}
\makeatother

%\renewcommand{\textfraction}{0.01}
%\setcounter{topnumber}{100}
%\setcounter{dbltopnumber}{100}
%\setcounter{totalnumber}{100}
%\renewcommand{\topfraction}{.9}
%\renewcommand{\floatpagefraction}{.9}
%\renewcommand{\dbltopfraction}{.9}
%\renewcommand{\dblfloatpagefraction}{.9}
%
%\newcounter{cnt}

%\setlength{\abovecaptionskip}{0in}
%\setlength{\belowcaptionskip}{0in}


%make latex layout figures better
%\renewcommand{\topfraction}{0.85}
%\renewcommand{\textfraction}{0.09}
%\renewcommand{\floatpagefraction}{0.85}


\date{}

%\newsavebox{\mylistingbox}
%
%\pagestyle{fancy}
%\fancyhead{}
%\fancyhf{}
%\renewcommand{\headrulewidth}{0pt}
%\setcounter{page}{1}
%%\usepackage{epstopdf}

% Notes
\usepackage{trimspaces}
\makeatletter
\newcommand{\newcommenter}[3]{%
  \ifdraft
    \newcommand{#1}[1]{%
      \begingroup\small\sffamily\color{#2}%
        [#3: \trim@spaces{##1}]%
      \endgroup%
    }%
  \else
    \newcommand{#1}[1]{\ignorespaces}
  \fi
}
\makeatother
\definecolor{darkgreen}{rgb}{0,0.7,0}

\newcommenter{\ethan}{darkgreen}{Ethan}
\newcommenter{\akh}{purple}{AKH}

\newcommand{\todo}[1]{\bgroup\small\sffamily\color{red}[\textbf{Todo:} #1]\egroup}

%% === Program Syntax ===
\newcounter{numlevels}
\NewDocumentCommand{\newMLP}{sO{l}mO{0}om}{
  \IfBooleanTF{#1}{
    \IfValueTF{#5}{
      \WithSuffix\newcommand#3*[#4][#5]
    }{
      \WithSuffix\newcommand#3*[#4]
    }
  }{
    \IfValueTF{#5}{
      \newcommand{#3}[#4][#5]
    }{
      \newcommand{#3}[#4]
    }
  }
  {\ifthenelse{\value{numlevels} > 0}{\begin{array}[t]{@{}#2@{}}}{\begin{array}{#2}}\addtocounter{numlevels}{1}#6\addtocounter{numlevels}{-1}\end{array}}
}
\makeatletter
\def\def@block@inner#1#2#3\_nil{#1 & #2\ifx\relax#3\relax\else \\ \def@block@inner#3\_nil\fi}%
\newcommand{\typeset@def@block}[2]{\begin{array}[t]{@{}l@{{}#1{}}l@{}}\def@block@inner#2\_nil\end{array}}
\makeatother

\newcommand{\ty}{\mkern2mu{:}\mkern2mu}
\newcommand{\proves}{\vdash}
\newcommand{\nproves}{\nvdash}
\newcommand{\dom}[1]{\operatorname{dom}({#1})}
\newcommand{\seq}{\mathrel{;}}
\newcommand{\sendsto}{\rightsquigarrow}

\definecolor{chorcolor}{HTML}{0053A9}
\definecolor{localcolor}{HTML}{007C21}
\definecolor{ntwkcolor}{HTML}{E44223}
\definecolor{choicecolor}{HTML}{BB7A00}
\definecolor{loccolor}{HTML}{b51963}
\newcommand{\LocalCol}[1]{{\color{localcolor}#1}}

\newcommand{\programfont}[1]{\ensuremath{\mathsf{#1}}\xspace}
\newcommand{\LocalLangFont}[1]{\programfont{\LocalCol{#1}}}
\newcommand{\LocFont}[1]{\programfont{\color{loccolor}#1}}

\newcommand{\Mngr}{\LocFont{M}}
\newcommand{\Client}{\LocFont{C}}
\newcommand{\Alice}{\LocFont{A}}
\newcommand{\Bob}{\LocFont{B}}
\newcommand{\Cathy}{\LocFont{C}}
\newcommand{\Dave}{\LocFont{D}}

%% Choreographic Syntax
\newcommand{\ChorCol}[1]{{\color{chorcolor}#1}}
\newcommand{\ChorFont}[1]{\programfont{\ChorCol{#1}}}

\newcommand{\ChorDef}{\mathrel{\ChorCol{\coloneqq}}}
\newcommand{\ColSend}{\mathrel{\ChorCol{\sendsto}}}

\newcommand{\multircv}[1][n]{\mathrel{\mathchoice%
  {\mathord{\sendsto}\mkern-2mu\raisebox{0.125ex}{$\scriptstyle[#1]$}}
  {\mathord{\sendsto}\mkern-2mu\raisebox{0.125ex}{$\scriptstyle[#1]$}}
  {\mathord{\sendsto}\mkern-1mu\raisebox{0.1ex}{$\scriptstyle[#1]$}\mkern3mu}
  {\mathord{\sendsto}\mkern-1mu\raisebox{0.05ex}{$\scriptstyle[#1]$}\mkern3mu}%
}}
%\newcommand{\multircv}[1]{\mathrel{\overset{#1}{\sendsto}}}

\newcommand{\IfN}{\ChorFont{if}}
\newcommand{\Then}{\ChorFont{then}}
\newcommand{\Else}{\ChorFont{else}}
\newcommand{\ForkN}{\ChorFont{fork}}
\newcommand{\LetN}{\ChorFont{let}}
\newcommand{\In}{\ChorFont{in}}
\newcommand{\FunN}{\ChorFont{fun}}
\newcommand{\LamN}{\ChorCol{\lambda}}
\newcommand{\TLamN}{\ChorCol{\Lambda}}

\newcommand{\ForkIn}[3]{{#1}.\ForkN~{#2}~\In~{#3}}
\newMLP*{\ForkIn}[3]{{#1}.\ForkN~{#2} \\ \In~{#3}}
\newcommand{\LetInRaw}[2]{\LetN~{#1}~\In~{#2}}
\newMLP*[r@{~}l]{\LetInRaw}[2]{\LetN & {#1} \\ \In & {#2}}
\newcommand{\LetIn}[3]{\LetInRaw{{#1} \ChorDef {#2}}{#3}}
\WithSuffix\newcommand\LetIn*[3]{\LetInRaw*{{#1} \ChorDef {#2}}{#3}}
\makeatletter
\newMLP{\LetMany}[2]{\LetN ~ {\typeset@def@block{\ChorDef}{#1}} \\ \In ~ {#2}}
\makeatother
\newcommand{\Fun}[3]{\operatorname{\FunN}{#1}({#2}) \ChorDef {#3}}
\newMLP*{\Fun}[3]{\operatorname{\FunN}{#1}({#2}) \ChorDef \\ {#3}}
\newcommand{\ITE}[3]{\IfN~{#1}~\Then~{#2}~\Else~{#3}}
\newMLP*{\ITE}[3]{\IfN~{#1} \\ \Then~{#2} \\ \Else~{#3}}

%% Network Syntax
\newcommand{\NtwkCol}[1]{{\color{ntwkcolor}#1}}
\newcommand{\NtwkFont}[1]{\ensuremath{\mathtt{\NtwkCol{#1}}}\xspace}

\newcommand{\AmIinN}{\NtwkFont{AmI\mathord{\in}}}
\newcommand{\AmIin}[3]{\ensuremath{\operatorname{\AmIinN} #1 \mathbin{\NtwkFont{?}} #2 \mathbin{\NtwkFont{:}} #3}}
\newcommand{\AmIN}{\NtwkFont{AmI}}
\newcommand{\AmI}[3]{\ensuremath{\operatorname{\AmIN} #1 \mathbin{\NtwkFont{?}} #2 \mathbin{\NtwkFont{:}} #3}}

% === Outline structure ===
\usepackage{boxedminipage}
\makeatletter
\newcounter{outline@templateDepth}
\newcounter{outline@depth}
\newenvironment{outline}[2][0]{%
  \newlist{lvl}{enumerate}{6}%
  \setlist[lvl]{parsep=0.33\baselineskip,itemsep=0pt,topsep=0pt,leftmargin=1.5em}%
  \setlist[lvl,1]{leftmargin=*,topsep=0.5em}%
  %
  \setcounter{outline@templateDepth}{#1}%
  \setcounter{outline@depth}{1}%
  \@whilenum\value{outline@templateDepth}<6\do{%
    \ifcase\value{outline@templateDepth}\relax
      \setlist*[lvl,\value{outline@depth}]{label=\Roman*.}%
    \or
      \setlist*[lvl,\value{outline@depth}]{label=\Alph*.}%
    \or
      \setlist*[lvl,\value{outline@depth}]{label=\arabic*.}%
    \or
      \setlist*[lvl,\value{outline@depth}]{label=\alph*.}%
    \or
      \setlist*[lvl,\value{outline@depth}]{label=\roman*.}%
    \or
      \setlist*[lvl,\value{outline@depth}]{label=-}%
    \fi
    \stepcounter{outline@depth}%
    \stepcounter{outline@templateDepth}%
  }
  \if\relax\detokenize{#2}\relax\else
    \par\noindent{\bfseries #2}\par%
  \fi
  \noindent%
  \begin{lvl}%
}{\end{lvl}\vspace{0.25em}}
\newenvironment{boxedoutline}[2][0]{
  \begin{boxedminipage}{\textwidth}
  \begin{outline}[#1]{#2}
}{\end{outline}\end{boxedminipage}\vspace{0.5em}\par}
\makeatother

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "desc"
%%% End:
